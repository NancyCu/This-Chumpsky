<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CFG → CNF Converter (Pyodide)</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.28.0/full/pyodide.js"></script>
  <style>
    body { font-family: system-ui; padding: 1rem; max-width: 42rem; margin: auto; }
    textarea { width: 100%; }
    pre { padding: 1rem; background: #f6f8fa; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>CFG → CNF Converter (Pyodide)</h1>
  <textarea id="src" rows="6">S -> ASA | aB
A -> B | S
B -> b | ε</textarea><br>
  <button id="run">Convert to CNF</button>
  <pre id="out"></pre>

  <script type="module">
    const pyodide = await loadPyodide();

    const pythonCode = `
import re
from collections import defaultdict

def parse_cfg(text):
    grammar = defaultdict(list)
    for line in text.strip().splitlines():
        if not line.strip(): continue
        left, right = re.split(r'\\s*->\\s*', line)
        for production in right.split('|'):
            prod = production.strip().replace('E', 'ε')
            symbols = prod.split() if ' ' in prod else list(prod)
            grammar[left.strip()].append(symbols)
    return dict(grammar)

def format_grammar(grammar):
    lines = []
    for nt, prods in grammar.items():
        right = [" ".join(prod) for prod in prods]
        lines.append(f"{nt} -> {' | '.join(right)}")
    return "\\n".join(lines)

def to_cnf(text):
    grammar = parse_cfg(text)
    steps = []

    def add_step(title, g):
        steps.append((title, format_grammar(g)))

    start = next(iter(grammar))
    add_step("Original grammar", grammar)
    add_step("After ε-removal (dummy)", grammar)
    add_step("After unit removal (dummy)", grammar)
    add_step("Final CNF (dummy)", grammar)

    return "\\n\\n".join(f"{title}:\\n{g}" for title, g in steps)
`;
    pyodide.runPython(pythonCode);

    document.getElementById("run").onclick = () => {
      const raw = document.getElementById("src").value;
      const result = pyodide.runPython(`to_cnf("""${raw}""")`);
      document.getElementById("out").textContent = result;
    };
  </script>
</body>
</html>
